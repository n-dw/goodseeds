{% extends 'shop/_layouts/main' %}

{% set formParams = {'productParam' : ''} %}
{% import "shop/macros/product.html" as prodmac %}

{% set params = {with: ['productImages']} %}
{% set categoriesArray = ['or'] %}

{% if category.slug %}
    {% set cat = craft.categories.slug(category.slug).ids() %}
    {% set categoriesArray = categoriesArray|merge([{targetElement: cat,}]) %}
    {% set params = params|merge({relatedTo : categoriesArray}) %}
    {% set params = params|merge({order : 'postDate DESC'}) %}
{% endif %}

{% set products = craft.commerce.products(params) %}
{% set hashVal =  craft.thcpost.hashValue(formParams) %}

{% block main %}
    <section class="shop product-listings product-listing-app content-section">
        <div class="wrapper container-fluid">
            <h1 class="page-title">Shop {{ category.title }}</h1>
            <div class="products-list has-text-centered row">
                {% set imageSetting = { width: 460, ratio: 1 , jpegQuality: 85} %}
                {% cache  globally using key "products-" ~ craft.request.path ~ '-' ~ hashVal %}
                {% minify %}
                {% for product in products %}
                    {% include '/shop/_includes/product/_productCard.html' %}
                {% endfor %}
                {% endminify %}
                {% endcache %}
            </div>
        </div>
    </section>
{% endblock %}
